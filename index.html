<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SOC Enterprise v3</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    margin:0;
    background:#0e1624;
    font-family: Inter, Segoe UI, sans-serif;
    color:#e5e7eb;
}
.header{
    padding:20px 30px;
    background:#111827;
    border-bottom:1px solid #1f2937;
    display:flex;
    justify-content:space-between;
}
.title{
    font-size:20px;
    font-weight:600;
    color:#00ffcc;
}
.container{ padding:30px; }
.grid{
    display:grid;
    grid-template-columns: repeat(4,1fr);
    gap:20px;
}
.card{
    background:#111827;
    padding:20px;
    border-radius:12px;
    border:1px solid #1f2937;
}
.card-title{
    font-size:12px;
    color:#9ca3af;
    text-transform:uppercase;
    margin-bottom:8px;
}
.value{
    font-size:30px;
    font-weight:600;
}
.green{color:#22c55e;}
.red{color:#ef4444;}
.purple{color:#8b5cf6;}
.progress{
    margin-top:10px;
    height:10px;
    background:#1f2937;
    border-radius:6px;
}
.progress-bar{
    height:100%;
    background:#22c55e;
    border-radius:6px;
}
.section{ margin-top:30px; }
.table{
    width:100%;
    border-collapse:collapse;
}
.table th{
    font-size:12px;
    color:#9ca3af;
    text-align:left;
    padding:10px 0;
    border-bottom:1px solid #1f2937;
}
.table td{
    padding:12px 0;
    border-bottom:1px solid #1f2937;
}
.status-up{color:#22c55e;font-weight:600;}
.status-down{color:#ef4444;font-weight:600;}
.status-unknown{color:#f59e0b;font-weight:600;}
</style>
</head>

<body>

<div class="header">
<div class="title">SOC Enterprise v3 â€“ Infrastructure Dashboard</div>
<div id="clock"></div>
</div>

<div class="container">

<div class="grid">
<div class="card">
<div class="card-title">Total Servers</div>
<div id="total" class="value">0</div>
</div>

<div class="card">
<div class="card-title">UP</div>
<div id="up" class="value green">0</div>
</div>

<div class="card">
<div class="card-title">DOWN</div>
<div id="down" class="value red">0</div>
</div>

<div class="card">
<div class="card-title">Daily Uptime</div>
<div id="uptime" class="value green">0%</div>
<div class="progress">
<div id="progressBar" class="progress-bar" style="width:0%"></div>
</div>
</div>
</div>

<div class="grid section">
<div class="card">
<div class="card-title">Bruteforce (24H)</div>
<div id="bruteforce" class="value red">0</div>
</div>

<div class="card">
<div class="card-title">DDoS (24H)</div>
<div id="ddos" class="value purple">0</div>
</div>

<div class="card" style="grid-column: span 2;">
<div class="card-title">Security Events</div>
<canvas id="chart"></canvas>
</div>
</div>

<div class="section card">
<div class="card-title">Zabbix Hosts</div>
<table class="table">
<thead>
<tr>
<th>Host</th>
<th>CPU</th>
<th>RAM</th>
<th>Net In</th>
<th>Net Out</th>
<th>Status</th>
</tr>
</thead>
<tbody id="hosts"></tbody>
</table>
</div>

</div>

<script>
let chart;

function load(){
fetch("/api/dashboard")
.then(res=>res.json())
.then(data=>{

document.getElementById("total").innerText=data.total;
document.getElementById("up").innerText=data.up;
document.getElementById("down").innerText=data.down;
document.getElementById("bruteforce").innerText=data.bruteforce;
document.getElementById("ddos").innerText=data.ddos;

document.getElementById("uptime").innerText=data.daily_uptime+"%";
document.getElementById("progressBar").style.width=data.daily_uptime+"%";
document.getElementById("clock").innerText=data.time;

let tbody=document.getElementById("hosts");
tbody.innerHTML="";

data.hosts.forEach(h=>{
let status="UNKNOWN";
let cls="status-unknown";

if(h.available==1){status="UP";cls="status-up";}
if(h.available==0){status="DOWN";cls="status-down";}

tbody.innerHTML+=`
<tr>
<td>${h.host}</td>
<td>${h.cpu.toFixed(1)}%</td>
<td>${h.ram.toFixed(1)}%</td>
<td>${h.net_in}</td>
<td>${h.net_out}</td>
<td class="${cls}">${status}</td>
</tr>`;
});

updateChart(data.bruteforce,data.ddos);
});
}

function updateChart(bf,dd){
if(chart) chart.destroy();

chart=new Chart(document.getElementById("chart"),{
type:"bar",
data:{
labels:["Bruteforce","DDoS"],
datasets:[{
data:[bf,dd],
backgroundColor:["#ef4444","#8b5cf6"]
}]
},
options:{
plugins:{legend:{display:false}},
scales:{
x:{ticks:{color:"#9ca3af"}},
y:{ticks:{color:"#9ca3af"}}
}
}
});
}

load();
setInterval(load,60000);
</script>

</body>
</html>
